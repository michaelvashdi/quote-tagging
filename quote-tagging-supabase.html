<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quote Tagging System - 4D Emotional Matching</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #faf5ff, #eff6ff);
            min-height: 100vh;
        }
    </style>
</head>
<body class="p-6">
    <div id="app" class="max-w-6xl mx-auto"></div>

    <script>
        // State management
        let state = {
            quotes: [],
            currentIndex: 0,
            currentTags: {
                emotions: [],
                lifeareas: [],
                needs: [],
                corequestions: []
            },
            view: 'tagging',
            newQuote: { quote: '', author: '', source: '' },
            duplicateWarning: ''
        };

        // Tag system configuration
        const tagSystem = {
            emotions: {
                question: "What emotional states does this quote address?",
                tags: {
                    Scared: "Fear, anxiety, worry, panic, terror",
                    Sad: "Grief, heartbreak, depression, sorrow",
                    Angry: "Frustration, resentment, irritation, rage",
                    Lost: "Confused, directionless, uncertain",
                    Alone: "Lonely, isolated, disconnected",
                    Loving: "Feeling love, connected, warm",
                    Happy: "Joyful, content, grateful, celebrating",
                    Calm: "Peaceful, serene, tranquil, centered",
                    Hopeful: "Optimistic, inspired, encouraged",
                    Doubtful: "Uncertain, questioning, lacking confidence"
                },
                recommended: "2-3 tags"
            },
            lifeareas: {
                question: "What situations or life areas does this quote apply to?",
                tags: {
                    Relationship: "Romantic partnerships, dating, marriage",
                    Selfworth: "Self-esteem, identity, self-love",
                    Purpose: "Life direction, meaning, calling",
                    Spiritual: "Spiritual growth, enlightenment, awakening",
                    Loss: "Death, endings, grief, letting go",
                    NewBeginning: "Transitions, fresh starts, change",
                    Work: "Career, service, contribution",
                    Healing: "Recovery from pain, trauma, illness",
                    Family: "Parents, children, siblings, community",
                    InnerPeace: "Meditation, stillness, finding calm"
                },
                recommended: "2-4 tags"
            },
            needs: {
                question: "What does someone NEED when they read this quote?",
                tags: {
                    Comfort: "Reassurance, 'it's going to be okay'",
                    Motivation: "Encouragement to keep going",
                    Wisdom: "Understanding, insight, deeper truth",
                    Permission: "Validation, 'it's okay to feel this'",
                    Direction: "Guidance on what to do",
                    Perspective: "New way of seeing, reframe",
                    Acceptance: "Surrender, letting go, 'stop fighting'",
                    Strength: "Reminder of inner power, resilience"
                },
                recommended: "2-3 tags"
            },
            corequestions: {
                question: "What deep existential question does this quote answer?",
                tags: {
                    "Am I enough?": "Worthiness, adequacy, self-value",
                    "Will I be okay?": "Safety, survival, security, future",
                    "Does anyone care?": "Love, belonging, being seen",
                    "What's the point?": "Meaning, purpose, 'why am I here?'",
                    "Am I doing it right?": "Validation, correctness, approval",
                    "Why is this happening?": "Understanding suffering",
                    "How do I let go?": "Release, surrender, detachment",
                    "Who am I really?": "Identity, true self, authenticity"
                },
                recommended: "1-2 tags"
            }
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('quoteTags');
            if (saved) {
                state.quotes = JSON.parse(saved);
            }
        }

        // Save data to localStorage
        function saveData() {
            if (state.quotes.length > 0) {
                localStorage.setItem('quoteTags', JSON.stringify(state.quotes));
            }
        }

        // Toggle tag selection
        function toggleTag(dimension, tag) {
            const current = state.currentTags[dimension];
            if (current.includes(tag)) {
                state.currentTags[dimension] = current.filter(t => t !== tag);
            } else {
                state.currentTags[dimension] = [...current, tag];
            }
            render();
        }

        // Save current quote
        function saveCurrentQuote() {
            const currentQuote = state.quotes[state.currentIndex];
            if (!currentQuote) return;
            
            state.quotes[state.currentIndex] = {
                ...currentQuote,
                ...state.currentTags,
                tagged: true
            };
            saveData();
            
            // Move to next untagged quote
            const nextUntagged = state.quotes.findIndex((q, i) => i > state.currentIndex && !q.tagged);
            if (nextUntagged !== -1) {
                state.currentIndex = nextUntagged;
            } else if (state.currentIndex < state.quotes.length - 1) {
                state.currentIndex++;
            }
            
            // Reset tags
            state.currentTags = { emotions: [], lifeareas: [], needs: [], corequestions: [] };
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            render();
        }

        // Load quote
        function loadQuote(index) {
            state.currentIndex = index;
            const quote = state.quotes[index];
            if (quote) {
                state.currentTags = {
                    emotions: quote.emotions || [],
                    lifeareas: quote.lifeareas || [],
                    needs: quote.needs || [],
                    corequestions: quote.corequestions || []
                };
            }
            render();
        }

        // Add new quote
        function addQuote() {
            if (!state.newQuote.quote.trim()) {
                state.duplicateWarning = 'Quote text is required';
                render();
                return;
            }

            const normalized = state.newQuote.quote.toLowerCase().trim();
            const duplicate = state.quotes.find(q => q.quote.toLowerCase().trim() === normalized);
            if (duplicate) {
                state.duplicateWarning = `Duplicate found! This quote already exists by ${duplicate.author}`;
                render();
                return;
            }

            state.quotes.push({
                quote: state.newQuote.quote.trim(),
                author: state.newQuote.author.trim() || 'Unknown',
                source: state.newQuote.source.trim() || '',
                emotions: [],
                lifeareas: [],
                needs: [],
                corequestions: [],
                tagged: false
            });

            saveData();
            state.newQuote = { quote: '', author: '', source: '' };
            state.duplicateWarning = '';
            state.view = 'tagging';
            state.currentIndex = state.quotes.length - 1;
            render();
        }

        // Import CSV
        function importCSV() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    const text = event.target.result;
                    const lines = text.split('\n');
                    const imported = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        const matches = line.match(/(?:^|,)("(?:[^"]|"")*"|[^,]*)/g);
                        if (!matches || matches.length < 3) continue;
                        
                        const clean = matches.map(m => m.replace(/^,?"?|"?$/g, '').replace(/""/g, '"'));
                        
                        imported.push({
                            quote: clean[0],
                            author: clean[1] || 'Unknown',
                            source: clean[2] || '',
                            emotions: clean[3] ? clean[3].split(';') : [],
                            lifeareas: clean[4] ? clean[4].split(';') : [],
                            needs: clean[5] ? clean[5].split(';') : [],
                            corequestions: clean[6] ? clean[6].split(';') : [],
                            tagged: clean[3] ? true : false
                        });
                    }
                    
                    state.quotes = imported;
                    state.currentIndex = 0;
                    saveData();
                    render();
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Export CSV
        function exportCSV() {
            let csv = 'quote,author,source,emotions,lifeareas,needs,corequestions\n';
            
            state.quotes.forEach(q => {
                const quote = `"${q.quote.replace(/"/g, '""')}"`;
                const author = `"${q.author.replace(/"/g, '""')}"`;
                const source = `"${q.source.replace(/"/g, '""')}"`;
                const emotions = q.emotions.join(';');
                const lifeareas = q.lifeareas.join(';');
                const needs = q.needs.join(';');
                const corequestions = q.corequestions.join(';');
                
                csv += `${quote},${author},${source},${emotions},${lifeareas},${needs},${corequestions}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'spiritual_quotes_tagged_4d_system.csv';
            a.click();
        }

        // Get statistics
        function getStatistics() {
            const stats = {
                emotions: {},
                lifeareas: {},
                needs: {},
                corequestions: {}
            };

            state.quotes.forEach(q => {
                if (!q.tagged) return;
                ['emotions', 'lifeareas', 'needs', 'corequestions'].forEach(dim => {
                    (q[dim] || []).forEach(tag => {
                        stats[dim][tag] = (stats[dim][tag] || 0) + 1;
                    });
                });
            });

            return stats;
        }

        // Render function
        function render() {
            const app = document.getElementById('app');
            const currentQuote = state.quotes[state.currentIndex];
            const progress = {
                total: state.quotes.length,
                tagged: state.quotes.filter(q => q.tagged).length,
                percentage: state.quotes.length > 0 ? Math.round((state.quotes.filter(q => q.tagged).length / state.quotes.length) * 100) : 0
            };

            if (state.view === 'tagging') {
                app.innerHTML = `
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                            <div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Quote Tagging System</h1>
                                <p class="text-gray-600">4D Emotional Matching</p>
                            </div>
                            <div class="flex gap-3 flex-wrap">
                                <button onclick="setView('management')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    ‚ûï Manage Quotes
                                </button>
                                <button onclick="setView('statistics')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    üìä Statistics
                                </button>
                                <button onclick="exportCSV()" ${state.quotes.length === 0 ? 'disabled' : ''} class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50">
                                    ‚¨áÔ∏è Export CSV
                                </button>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Progress: ${progress.tagged} / ${progress.total} quotes tagged</span>
                                <span class="font-semibold text-purple-600">${progress.percentage}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-purple-500 to-blue-500 h-3 rounded-full transition-all duration-300" style="width: ${progress.percentage}%"></div>
                            </div>
                        </div>
                    </div>

                    ${state.quotes.length === 0 ? `
                        <div class="bg-white rounded-lg shadow-lg p-12 text-center">
                            <div class="text-6xl mb-4">üè∑Ô∏è</div>
                            <h2 class="text-2xl font-semibold text-gray-800 mb-2">No Quotes Yet</h2>
                            <p class="text-gray-600 mb-6">Import a CSV file or add quotes manually to get started</p>
                            <div class="flex gap-4 justify-center">
                                <button onclick="importCSV()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    Import CSV
                                </button>
                                <button onclick="setView('management')" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    Add Quotes Manually
                                </button>
                            </div>
                        </div>
                    ` : `
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <button onclick="loadQuote(${Math.max(0, state.currentIndex - 1)})" ${state.currentIndex === 0 ? 'disabled' : ''} class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 disabled:opacity-50">
                                    ‚Üê Previous
                                </button>
                                <div class="text-center">
                                    <span class="text-sm text-gray-600">Quote</span>
                                    <div class="text-2xl font-bold text-gray-800">
                                        ${state.currentIndex + 1} / ${state.quotes.length}
                                    </div>
                                </div>
                                <button onclick="loadQuote(${Math.min(state.quotes.length - 1, state.currentIndex + 1)})" ${state.currentIndex === state.quotes.length - 1 ? 'disabled' : ''} class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 disabled:opacity-50">
                                    Next ‚Üí
                                </button>
                            </div>

                            ${currentQuote ? `
                                <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg p-6">
                                    <p class="text-xl text-gray-800 mb-3 italic">"${currentQuote.quote}"</p>
                                    <p class="text-gray-700 font-semibold">‚Äî ${currentQuote.author}</p>
                                    ${currentQuote.source ? `<p class="text-gray-600 text-sm mt-1">${currentQuote.source}</p>` : ''}
                                    ${currentQuote.tagged ? '<div class="mt-3 inline-flex items-center gap-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">‚úì Already Tagged</div>' : ''}
                                </div>
                            ` : ''}
                        </div>

                        ${currentQuote ? renderTaggingInterface(currentQuote) : ''}
                    `}
                `;
            } else if (state.view === 'management') {
                app.innerHTML = renderManagementView();
            } else if (state.view === 'statistics') {
                app.innerHTML = renderStatisticsView();
            }
        }

        function renderTaggingInterface(currentQuote) {
            let html = '<div class="space-y-6">';
            
            Object.entries(tagSystem).forEach(([dimension, data]) => {
                html += `
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg p-4 mb-4">
                            <p class="text-lg text-gray-800 italic">"${currentQuote.quote}"</p>
                            <p class="text-gray-700 font-semibold mt-2">‚Äî ${currentQuote.author}</p>
                        </div>
                        
                        <div class="mb-4">
                            <h3 class="text-xl font-bold text-gray-800 mb-1 capitalize">
                                ${dimension.replace('corequestions', 'Core Questions')}
                            </h3>
                            <p class="text-gray-600 mb-1">${data.question}</p>
                            <p class="text-sm text-purple-600 font-semibold">Recommended: ${data.recommended}</p>
                            <p class="text-sm text-gray-500 mt-1">
                                Selected: ${state.currentTags[dimension].length}
                            </p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                `;
                
                Object.entries(data.tags).forEach(([tag, description]) => {
                    const isSelected = state.currentTags[dimension].includes(tag);
                    html += `
                        <button onclick="toggleTag('${dimension}', '${tag.replace(/'/g, "\\\'")}')" class="p-4 rounded-lg border-2 text-left transition-all ${isSelected ? 'border-purple-500 bg-purple-50 shadow-md' : 'border-gray-200 hover:border-purple-300 hover:bg-gray-50'}">
                            <div class="flex items-start justify-between mb-2">
                                <span class="font-semibold text-gray-800">${tag}</span>
                                ${isSelected ? '<span class="text-purple-600 text-xl">‚úì</span>' : ''}
                            </div>
                            <p class="text-sm text-gray-600">${description}</p>
                        </button>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += `
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-1">Ready to Save?</h3>
                            <p class="text-sm text-gray-600">Make sure you've selected tags for all dimensions</p>
                        </div>
                        <button onclick="saveCurrentQuote()" class="px-8 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 font-semibold text-lg shadow-lg">
                            Save & Next
                        </button>
                    </div>
                </div>
            </div>`;
            
            return html;
        }

        function renderManagementView() {
            return `
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                        <h2 class="text-2xl font-bold text-gray-800">Quote Management</h2>
                        <div class="flex gap-3">
                            <button onclick="importCSV()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                Import CSV
                            </button>
                            <button onclick="setView('tagging')" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                Back to Tagging
                            </button>
                        </div>
                    </div>

                    <div class="bg-blue-50 rounded-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Add New Quote</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Quote Text *</label>
                                <textarea id="newQuoteText" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="3" placeholder="Enter the quote text...">${state.newQuote.quote}</textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Author</label>
                                    <input type="text" id="newQuoteAuthor" value="${state.newQuote.author}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Author name">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Source</label>
                                    <input type="text" id="newQuoteSource" value="${state.newQuote.source}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Source URL or book">
                                </div>
                            </div>
                            ${state.duplicateWarning ? `
                                <div class="flex items-center gap-2 text-red-600 bg-red-50 p-3 rounded-lg">
                                    <span>‚ö†Ô∏è</span>
                                    <span>${state.duplicateWarning}</span>
                                </div>
                            ` : ''}
                            <button onclick="addQuoteFromForm()" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                                Add Quote
                            </button>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">All Quotes (${state.quotes.length})</h3>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${state.quotes.map((q, idx) => `
                                <div onclick="loadQuote(${idx}); setView('tagging')" class="p-4 border border-gray-200 rounded-lg hover:border-purple-300 cursor-pointer">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <p class="text-gray-800 mb-1">"${q.quote}"</p>
                                            <p class="text-sm text-gray-600">‚Äî ${q.author}</p>
                                        </div>
                                        <div class="ml-4">
                                            ${q.tagged ? 
                                                '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs">‚úì Tagged</span>' : 
                                                '<span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs">Untagged</span>'
                                            }
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStatisticsView() {
            const stats = getStatistics();
            const taggedCount = state.quotes.filter(q => q.tagged).length;
            const progress = {
                total: state.quotes.length,
                tagged: taggedCount,
                percentage: state.quotes.length > 0 ? Math.round((taggedCount / state.quotes.length) * 100) : 0
            };

            let html = `
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Tag Statistics</h2>
                        <button onclick="setView('tagging')" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                            Back to Tagging
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="bg-blue-50 rounded-lg p-6 text-center">
                            <div class="text-4xl font-bold text-blue-600 mb-2">${state.quotes.length}</div>
                            <div class="text-gray-600">Total Quotes</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-6 text-center">
                            <div class="text-4xl font-bold text-green-600 mb-2">${taggedCount}</div>
                            <div class="text-gray-600">Tagged Quotes</div>
                        </div>
                        <div class="bg-orange-50 rounded-lg p-6 text-center">
                            <div class="text-4xl font-bold text-orange-600 mb-2">${state.quotes.length - taggedCount}</div>
                            <div class="text-gray-600">Untagged Quotes</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-6 text-center">
                            <div class="text-4xl font-bold text-purple-600 mb-2">${progress.percentage}%</div>
                            <div class="text-gray-600">Complete</div>
                        </div>
                    </div>
            `;

            if (taggedCount > 0) {
                Object.entries(tagSystem).forEach(([dimension, data]) => {
                    html += `
                        <div class="bg-gray-50 rounded-lg p-6 mb-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 capitalize">
                                ${dimension.replace('corequestions', 'Core Questions')}
                            </h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                    `;
                    
                    Object.keys(data.tags).forEach(tag => {
                        const count = stats[dimension][tag] || 0;
                        const percentage = taggedCount > 0 ? Math.round((count / taggedCount) * 100) : 0;
                        html += `
                            <div class="bg-white rounded-lg p-4 border border-gray-200">
                                <div class="text-2xl font-bold text-purple-600 mb-1">${count}</div>
                                <div class="text-sm text-gray-800 font-semibold mb-1">${tag}</div>
                                <div class="text-xs text-gray-500">${percentage}% of tagged</div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
            } else {
                html += `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üìä</div>
                        <p class="text-gray-600">No tagged quotes yet. Start tagging to see statistics!</p>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }

        function setView(view) {
            state.view = view;
            render();
        }

        function addQuoteFromForm() {
            state.newQuote = {
                quote: document.getElementById('newQuoteText').value,
                author: document.getElementById('newQuoteAuthor').value,
                source: document.getElementById('newQuoteSource').value
            };
            addQuote();
        }

        // Initialize
        loadData();
        render();
    </script>
</body>
</html>
